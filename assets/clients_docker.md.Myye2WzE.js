import{_ as t,o,c as a,ag as i}from"./chunks/framework.cqfd-qMR.js";const p=JSON.parse('{"title":"Docker Container Interception","description":"","frontmatter":{},"headers":[],"relativePath":"clients/docker.md","filePath":"clients/docker.md"}'),n={name:"clients/docker.md"};function r(s,e,c,l,d,h){return o(),a("div",null,[...e[0]||(e[0]=[i('<h1 id="docker-container-interception" tabindex="-1">Docker Container Interception <a class="header-anchor" href="#docker-container-interception" aria-label="Permalink to &quot;Docker Container Interception&quot;">​</a></h1><p>Glance provides a seamless, one-click interception method for Docker containers. This allows you to inspect and modify traffic from any containerized application without manual configuration or restarts.</p><h2 id="how-interception-works" tabindex="-1">How Interception Works <a class="header-anchor" href="#how-interception-works" aria-label="Permalink to &quot;How Interception Works&quot;">​</a></h2><p>Glance uses a <strong>Container Recreation</strong> strategy to ensure that all processes within a container correctly pick up proxy settings. When you click <strong>&quot;Intercept Traffic&quot;</strong> in the dashboard, Glance performs the following steps:</p><ol><li><strong>Configuration Capture</strong>: Glance inspects the running container to read its current environment variables, volume mounts, network settings, and labels.</li><li><strong>Container Backup</strong>: The original container is stopped and renamed to <code>{original_name}-glance-backup</code>.</li><li><strong>Environment Injection</strong>: Glance creates a new container with the same name and configuration as the original, but injects the following environment variables: <ul><li><code>HTTP_PROXY</code> and <code>HTTPS_PROXY</code>: Pointed to the host&#39;s Glance proxy.</li><li><code>JAVA_TOOL_OPTIONS</code>: Injected with JVM system properties (<code>-Dhttp.proxyHost</code>, etc.) to ensure Java applications are intercepted.</li><li><code>glance.interception=active</code>: A label used to track the interception state.</li></ul></li><li><strong>CA Certificate Injection</strong>: Glance automatically detects the container&#39;s OS (Alpine, Debian, or RHEL) and injects its CA certificate into the system trust store and the Java Trust Store (<code>cacerts</code>).</li><li><strong>Start</strong>: The new intercepted container is started, and traffic begins flowing through Glance.</li></ol><p>When you click <strong>&quot;Stop Intercept&quot;</strong>, Glance removes the intercepted container and restores the original backup to its original name and state.</p><h2 id="features" tabindex="-1">Features <a class="header-anchor" href="#features" aria-label="Permalink to &quot;Features&quot;">​</a></h2><h3 id="universal-compatibility" tabindex="-1">Universal Compatibility <a class="header-anchor" href="#universal-compatibility" aria-label="Permalink to &quot;Universal Compatibility&quot;">​</a></h3><p>By using environment variables (<code>HTTP_PROXY</code>) and JVM options (<code>JAVA_TOOL_OPTIONS</code>), Glance can intercept traffic from almost any runtime, including:</p><ul><li><strong>Java / Spring Boot / JVM</strong></li><li><strong>Node.js / Python / Go</strong></li><li><strong>CLI tools like cURL and wget</strong></li></ul><h3 id="automatic-https-decryption" tabindex="-1">Automatic HTTPS Decryption <a class="header-anchor" href="#automatic-https-decryption" aria-label="Permalink to &quot;Automatic HTTPS Decryption&quot;">​</a></h3><p>Glance handles the complexity of SSL trust for you:</p><ul><li><strong>System Trust</strong>: Automatically runs <code>update-ca-certificates</code> or <code>update-ca-trust</code> inside the container.</li><li><strong>Java KeyStore</strong>: Automatically locates the <code>cacerts</code> file and uses <code>keytool</code> to import the Glance CA, preventing <code>SSLHandshakeException</code> in JVM apps.</li></ul><h3 id="no-special-capabilities-required" tabindex="-1">No Special Capabilities Required <a class="header-anchor" href="#no-special-capabilities-required" aria-label="Permalink to &quot;No Special Capabilities Required&quot;">​</a></h3><p>Unlike <code>iptables</code>-based methods, this approach does <strong>not</strong> require the <code>--cap-add=NET_ADMIN</code> capability, making it compatible with more restricted container environments.</p><h2 id="smart-host-detection" tabindex="-1">Smart Host Detection <a class="header-anchor" href="#smart-host-detection" aria-label="Permalink to &quot;Smart Host Detection&quot;">​</a></h2><p>In Docker environments, reaching the host&#39;s &quot;localhost&quot; from inside a container can be tricky. Glance automatically handles this:</p><ul><li><strong>Automatic Host Mapping</strong>: Glance injects <code>host.docker.internal:host-gateway</code> into the container&#39;s <code>extra_hosts</code> configuration. This allows the container to resolve <code>host.docker.internal</code> to the host machine even on standard Linux environments where this is not provided by default.</li><li><strong>Docker Desktop (macOS/Windows)</strong>: Uses <code>host.docker.internal</code> to route traffic to the host.</li><li><strong>Linux</strong>: Automatically detects the default bridge gateway IP and uses it as the proxy host.</li></ul><h2 id="usage-guide" tabindex="-1">Usage Guide <a class="header-anchor" href="#usage-guide" aria-label="Permalink to &quot;Usage Guide&quot;">​</a></h2><ol><li>Open the <strong>Glance Dashboard</strong> (<code>http://localhost:15501</code>).</li><li>Navigate to the <strong>Integrations</strong> tab.</li><li>Find your container in the <strong>Docker Containers</strong> list.</li><li>Click <strong>&quot;Intercept Traffic&quot;</strong>.</li><li>The container will briefly restart with the new proxy settings.</li><li>Start making requests from your containerized app—they will now appear in the <strong>Traffic</strong> tab.</li></ol><h2 id="troubleshooting" tabindex="-1">Troubleshooting <a class="header-anchor" href="#troubleshooting" aria-label="Permalink to &quot;Troubleshooting&quot;">​</a></h2><h3 id="container-fails-to-start" tabindex="-1">Container Fails to Start <a class="header-anchor" href="#container-fails-to-start" aria-label="Permalink to &quot;Container Fails to Start&quot;">​</a></h3><ul><li>Ensure Glance is running and reachable from your Docker network.</li><li>Check the container logs using <code>docker logs {container_name}</code> for any proxy-related startup errors.</li></ul><h3 id="https-traffic-not-intercepted" tabindex="-1">HTTPS Traffic Not Intercepted <a class="header-anchor" href="#https-traffic-not-intercepted" aria-label="Permalink to &quot;HTTPS Traffic Not Intercepted&quot;">​</a></h3><ul><li>If your application uses a custom keystore or hardcoded certificates, automatic injection may not work. You may need to manually trust the Glance CA within your application code.</li><li>Ensure the container has the <code>keytool</code> utility installed if it&#39;s a Java application.</li></ul><h3 id="container-name-conflicts" tabindex="-1">Container Name Conflicts <a class="header-anchor" href="#container-name-conflicts" aria-label="Permalink to &quot;Container Name Conflicts&quot;">​</a></h3><ul><li>If a previous interception session was interrupted, you might have a container named <code>{name}-glance-backup</code>. You may need to manually remove it or the intercepted container to resolve the conflict.</li></ul><h2 id="next-steps" tabindex="-1">Next Steps <a class="header-anchor" href="#next-steps" aria-label="Permalink to &quot;Next Steps&quot;">​</a></h2><ul><li><a href="./java.html">Java/JVM Guide</a> - More details on Java-specific interception</li><li><a href="./../troubleshooting.html">Troubleshooting</a> - Common issues and solutions</li><li><a href="./../features/traffic-inspection.html">Dashboard Overview</a> - Learn how to inspect the captured traffic</li></ul>',29)])])}const m=t(n,[["render",r]]);export{p as __pageData,m as default};
